.btn-debug {
            background: #f39c12;
            color: white;
            margin-left: 10px;
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trucking Insurance Quote Form - Internal Use</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header .contact-info {
            font-size: 16px;
            opacity: 0.95;
            margin: 15px 0;
        }
        
        .header .subtitle {
            border-top: 2px solid rgba(255,255,255,0.3);
            padding-top: 20px;
            margin-top: 20px;
        }
        

        
        .progress-bar {
            background: #e9ecef;
            height: 6px;
            position: relative;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .section {
            border-bottom: 1px solid #e9ecef;
        }
        
        .section:last-of-type {
            border-bottom: none;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-left: 5px solid #3498db;
            font-weight: 600;
            color: #2c3e50;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-status {
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 20px;
            background: #e9ecef;
            color: #6c757d;
        }
        
        .section-status.complete {
            background: #d4edda;
            color: #155724;
        }
        
        .section-status.partial {
            background: #fff3cd;
            color: #856404;
        }
        
        .section-content {
            padding: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        input.error, select.error, textarea.error {
            border-color: #e74c3c;
            background-color: #fdf2f2;
        }
        
        input.valid, select.valid, textarea.valid {
            border-color: #27ae60;
            background-color: #f8fff9;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        
        .notes {
            font-size: 12px;
            color: #6c757d;
            font-style: italic;
            margin-top: 4px;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .btn-save {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 30px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        
        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        .btn-save:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading-spinner {
            display: none;
            margin-left: 10px;
        }
        
        .validation-summary {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }
        
        .validation-summary h4 {
            color: #721c24;
            margin-bottom: 10px;
        }
        
        .validation-summary ul {
            margin-left: 20px;
            color: #721c24;
        }
        
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        .success-message h3 {
            color: #155724;
            margin-bottom: 10px;
        }
        
        .success-message p {
            color: #155724;
            margin: 10px 0;
        }
        
        .quote-summary {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .summary-header {
            color: #2c3e50;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .summary-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .summary-label {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .summary-value {
            font-size: 16px;
            color: #2c3e50;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 0;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .section-content {
                padding: 20px;
            }
        }
        
        @media print {
            .btn, button {
                display: none;
            }
            
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Network TruckInsurance Services, Inc.</h1>
            <div class="contact-info">
                <strong>Ed Zahnle - Licensed Agent/Broker</strong><br>
                Phone: (509) 215-3433 | Email: ed.zahnle@truckerinsurance.com
            </div>
            <div class="subtitle">
                <h2>Professional Insurance Quote Application</h2>
                <p>Complete Commercial Trucking Insurance Solutions</p>
            </div>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <!-- Validation Summary -->
        <div class="validation-summary" id="validationSummary">
            <h4>Please Complete Required Fields:</h4>
            <ul id="validationList"></ul>
        </div>
        
        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <h3>Quote Successfully Submitted!</h3>
            <p>Your quote has been submitted and saved to our system.</p>
            <p>A document request email has been sent to your provided email address.</p>
            <p>Ed Zahnle will contact you within 24 hours to discuss your quote.</p>
        </div>
        
        <form id="quoteForm" onsubmit="return false;" novalidate>
            <!-- Section 1: Business Information -->
            <div class="section">
                <div class="section-header">
                    <span>1. Business Information</span>
                    <span class="section-status" id="section1Status">Incomplete</span>
                </div>
                <div class="section-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="businessName">Business Name <span class="required">*</span></label>
                            <input type="text" id="businessName" name="businessName" required 
                                   placeholder="Legal name of insured">
                            <div class="error-message">Business name is required</div>
                            <div class="notes">Legal business name as registered</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dba">DBA (if different)</label>
                            <input type="text" id="dba" name="dba" 
                                   placeholder="Doing Business As name">
                            <div class="notes">Operating name if different from legal name</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="contactName">Contact Name <span class="required">*</span></label>
                            <input type="text" id="contactName" name="contactName" required 
                                   placeholder="Primary contact person">
                            <div class="error-message">Contact name is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phoneNumber">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="phoneNumber" name="phoneNumber" required 
                                   placeholder="(555) 123-4567">
                            <div class="error-message">Valid phone number is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="faxNumber">Fax Number</label>
                            <input type="tel" id="faxNumber" name="faxNumber" 
                                   placeholder="(555) 123-4567">
                        </div>
                        
                        <div class="form-group">
                            <label for="emailAddress">Email Address <span class="required">*</span></label>
                            <input type="email" id="emailAddress" name="emailAddress" required 
                                   placeholder="contact@company.com">
                            <div class="error-message">Valid email address is required</div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="businessAddress">Mailing Address <span class="required">*</span></label>
                            <input type="text" id="businessAddress" name="businessAddress" required 
                                   placeholder="Street Address" style="margin-bottom: 10px;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px;">
                                <input type="text" id="businessCity" name="businessCity" required placeholder="City">
                                <input type="text" id="businessState" name="businessState" required placeholder="State">
                                <input type="text" id="businessZip" name="businessZip" required placeholder="ZIP Code">
                            </div>
                            <div class="error-message">Complete mailing address is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="businessType">Business Type <span class="required">*</span></label>
                            <select id="businessType" name="businessType" required>
                                <option value="">Select business type...</option>
                                <option value="Individual">Individual</option>
                                <option value="Partnership">Partnership</option>
                                <option value="Corporation">Corporation</option>
                                <option value="LLC">LLC</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="error-message">Business type is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="usdotNumber">USDOT Number <span class="required">*</span></label>
                            <input type="text" id="usdotNumber" name="usdotNumber" required 
                                   placeholder="1234567">
                            <div class="error-message">USDOT number is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="mcNumber">MC Number <span class="required">*</span></label>
                            <input type="text" id="mcNumber" name="mcNumber" required 
                                   placeholder="MC-123456">
                            <div class="error-message">MC number is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="stateNumber">State Number</label>
                            <input type="text" id="stateNumber" name="stateNumber" 
                                   placeholder="CA-123456, TX-12345, etc.">
                            <div class="notes">State intrastate authority numbers</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="feinNumber">Federal EIN</label>
                            <input type="text" id="feinNumber" name="feinNumber" 
                                   placeholder="12-3456789">
                            <div class="notes">Federal Employer Identification Number</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="agencyNumber">Agency Number <span class="required">*</span></label>
                            <input type="text" id="agencyNumber" name="agencyNumber" required 
                                   placeholder="NTI-2024-001">
                            <div class="error-message">Agency number is required</div>
                            <div class="notes">Internal agency tracking identifier</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="yearsInBusiness">Years in Business <span class="required">*</span></label>
                            <select id="yearsInBusiness" name="yearsInBusiness" required>
                                <option value="">Select years in business...</option>
                                <option value="New Venture">New Venture</option>
                                <option value="<1">Less than 1 year</option>
                                <option value="1-3">1-3 years</option>
                                <option value="4-7">4-7 years</option>
                                <option value="8+">8+ years</option>
                            </select>
                            <div class="error-message">Years in business is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="grossReceipts">Annual Gross Receipts <span class="required">*</span></label>
                            <input type="text" id="grossReceipts" name="grossReceipts" required 
                                   placeholder="$500,000">
                            <div class="error-message">Annual gross receipts required</div>
                            <div class="notes">Current year estimated</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="priorYearReceipts">Prior Year Gross Receipts</label>
                            <input type="text" id="priorYearReceipts" name="priorYearReceipts" 
                                   placeholder="$450,000">
                            <div class="notes">Previous year actual</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quote Summary Section -->
            <div class="quote-summary">
                <div class="summary-header">Quote Summary</div>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Quote ID (USDOT)</div>
                        <div class="summary-value" id="quoteId">Enter USDOT number</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Date Created</div>
                        <div class="summary-value" id="quoteDate">Loading...</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Business Name</div>
                        <div class="summary-value" id="summaryBusinessName">Not entered</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Contact</div>
                        <div class="summary-value" id="summaryContactName">Not entered</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Submission Status</div>
                        <div class="summary-value" id="submissionStatus">Ready to Test</div>
                    </div>
                </div>
            </div>
        </form>
        
        <!-- Submit Button -->
        <div style="text-align: center; padding: 30px;">
            <button type="button" class="btn-save" id="submitBtn" onclick="submitQuote()">
                Generate Professional Quote PDF
                <span class="loading-spinner" id="loadingSpinner">âŸ³</span>
            </button>
        </div>
    </div>
    
    <!-- Load jsPDF from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
    
    <script>
        // Your deployed Google Apps Script URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxrcWAKtm8dDicdDNRToxyaR1YKzFHHBan-tJww4fNT9ZkDfHBZEXHdC14CChFMGexY/exec';
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeQuote();
            setupEventListeners();
        });
        
        function initializeQuote() {
            const today = new Date();
            const dateString = today.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('quoteId').textContent = 'Enter USDOT number';
            document.getElementById('quoteDate').textContent = dateString;
        }
        
        function setupEventListeners() {
            // Update summary on changes
            document.getElementById('businessName').addEventListener('input', function() {
                document.getElementById('summaryBusinessName').textContent = this.value || 'Not entered';
            });
            
            document.getElementById('contactName').addEventListener('input', function() {
                document.getElementById('summaryContactName').textContent = this.value || 'Not entered';
            });
            
            document.getElementById('usdotNumber').addEventListener('input', function() {
                updateQuoteId();
            });
        }
        
        function updateQuoteId() {
            const usdotNumber = document.getElementById('usdotNumber').value;
            const quoteId = usdotNumber ? `DOT-${usdotNumber}` : 'Enter USDOT number';
            document.getElementById('quoteId').textContent = quoteId;
            return quoteId;
        }
        
        function collectFormData() {
            const formData = {
                // Basic business info
                businessName: document.getElementById('businessName').value,
                contactName: document.getElementById('contactName').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                emailAddress: document.getElementById('emailAddress').value,
                businessAddress: document.getElementById('businessAddress').value,
                businessCity: document.getElementById('businessCity').value,
                businessState: document.getElementById('businessState').value,
                businessZip: document.getElementById('businessZip').value,
                businessType: document.getElementById('businessType').value,
                usdotNumber: document.getElementById('usdotNumber').value,
                mcNumber: document.getElementById('mcNumber').value,
                agencyNumber: document.getElementById('agencyNumber').value,
                yearsInBusiness: document.getElementById('yearsInBusiness').value,
                grossReceipts: document.getElementById('grossReceipts').value,
                priorYearReceipts: document.getElementById('priorYearReceipts').value,
                
                // Meta data
                quoteId: updateQuoteId(),
                submissionDate: new Date().toISOString(),
                timestamp: Date.now(),
                vehicleCount: 1, // Default for basic form
                selectedCoverages: ['Auto Liability'], // Default
                routesOfTravel: 'Western United States' // Default
            };
            
            return formData;
        }
        
        function validateBasicForm() {
            const requiredFields = [
                'businessName', 'contactName', 'phoneNumber', 'emailAddress',
                'businessAddress', 'businessCity', 'businessState', 'businessZip',
                'businessType', 'usdotNumber', 'mcNumber', 'agencyNumber', 'yearsInBusiness', 'grossReceipts'
            ];
            
            const errors = [];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    errors.push(fieldId);
                }
            });
            
            if (errors.length > 0) {
                const validationSummary = document.getElementById('validationSummary');
                const validationList = document.getElementById('validationList');
                
                validationList.innerHTML = errors.map(error => `<li>${error.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</li>`).join('');
                validationSummary.style.display = 'block';
                validationSummary.scrollIntoView({ behavior: 'smooth', block: 'start' });
                return false;
            }
            
            document.getElementById('validationSummary').style.display = 'none';
            return true;
        }
        
        async function submitQuote() {
            // Basic validation
            if (!validateBasicForm()) {
                return;
            }
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const spinner = document.getElementById('loadingSpinner');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.disabled = true;
            spinner.style.display = 'inline';
            submitBtn.innerHTML = 'Processing Quote... <span class="loading-spinner">âŸ³</span>';
            
            try {
                // Collect form data
                const formData = collectFormData();
                
                // Submit to Google Sheets
                await submitToGoogleSheets(formData);
                
                // Send document request email
                await sendDocumentRequestEmail(formData);
                
                // Generate PDF
                const pdfFilename = generateSimplePDF(formData);
                
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Update submission status
                document.getElementById('submissionStatus').textContent = 'Successfully Submitted';
                
            } catch (error) {
                alert('There was an issue submitting your quote. Your data may have been saved to our system. Ed Zahnle will contact you at the provided phone number.');
                
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                spinner.style.display = 'none';
                submitBtn.innerHTML = originalText;
            }
        }
        
        async function submitToGoogleSheets(formData) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                    mode: 'no-cors'
                });
                
                return true; // Assume success since we can't read the response in no-cors mode
                
            } catch (error) {
                // Don't throw error - the data was likely sent successfully
                return true;
            }
        }
        
        async function sendDocumentRequestEmail(formData) {
            try {
                const emailData = {
                    action: 'sendDocumentRequest',
                    from: 'ed.zahnle@truckerinsurance.com',
                    to: formData.emailAddress,
                    cc: 'ed.zahnle@truckerinsurance.com',
                    subject: `Document Request - Commercial Trucking Insurance Quote ${formData.quoteId}`,
                    html: generateEmailHTML(formData)
                };
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailData),
                    mode: 'no-cors'
                });
                
                return true; // Assume success
                
            } catch (error) {
                // Don't throw error - email may have been sent
                return true;
            }
        }
        
        function generateEmailHTML(formData) {
            return `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <div style="background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 20px; text-align: center;">
                        <h2>Network TruckInsurance Services, Inc.</h2>
                        <p>Ed Zahnle - Licensed Agent/Broker<br>
                        Phone: (509) 215-3433 | Email: ed.zahnle@truckerinsurance.com</p>
                    </div>
                    
                    <div style="padding: 30px; background: white;">
                        <p>Dear ${formData.contactName},</p>
                        
                        <p>Thank you for submitting your commercial trucking insurance quote request. I have received your application and am excited to help you secure competitive coverage for <strong>${formData.businessName}</strong>.</p>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-left: 4px solid #3498db; margin: 20px 0;">
                            <h3 style="color: #2c3e50; margin-top: 0;">Quote Summary:</h3>
                            <ul style="margin: 10px 0;">
                                <li><strong>Quote ID:</strong> ${formData.quoteId}</li>
                                <li><strong>Agency Number:</strong> ${formData.agencyNumber}</li>
                                <li><strong>Business:</strong> ${formData.businessName}</li>
                                <li><strong>USDOT:</strong> ${formData.usdotNumber}</li>
                                <li><strong>MC Number:</strong> ${formData.mcNumber}</li>
                                <li><strong>Contact:</strong> ${formData.contactName}</li>
                                <li><strong>Phone:</strong> ${formData.phoneNumber}</li>
                            </ul>
                        </div>
                        
                        <p>To complete your quote package and provide you with accurate pricing from our top-rated carriers (Progressive, Sentry, BHHC), I will need the following documents:</p>
                        
                        <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3 style="color: #856404; margin-top: 0;">ðŸ“‹ Required Documents:</h3>
                            <ol style="color: #856404;">
                                <li><strong>Loss Runs from your current/prior insurance carrier</strong> (last 5 years)
                                    <br><small>â€¢ This shows your claims history and is required by all underwriters</small>
                                </li>
                                <li><strong>IFTA Reports</strong> (last 4 quarters)
                                    <br><small>â€¢ Interstate Fuel Tax Agreement reports showing mileage by state</small>
                                </li>
                                <li><strong>Motor Vehicle Records (MVRs)</strong> - <em>We will handle ordering these directly</em>
                                    <br><small>â€¢ No action needed from you on MVRs</small>
                                </li>
                            </ol>
                        </div>
                        
                        <div style="background: #d4edda; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3 style="color: #155724; margin-top: 0;">ðŸš€ Need Help Getting Loss Runs?</h3>
                            <p style="color: #155724; margin-bottom: 0;">Many carriers require written authorization to release loss runs to agents. <strong>I can create the official request documents for you and send them via Adobe Sign for electronic signature.</strong> This makes the process quick and ensures your current carrier has everything they need to release your loss run history.</p>
                            
                            <p style="color: #155724; margin-bottom: 0;"><strong>Just reply to this email and let me know if you'd like me to prepare the loss run request documents for Adobe Sign!</strong></p>
                        </div>
                        
                        <h3 style="color: #2c3e50;">Next Steps:</h3>
                        <ol>
                            <li>Reply to this email with your IFTA reports (PDF format preferred)</li>
                            <li>Contact your current insurance carrier to request loss runs, or let me help with Adobe Sign requests</li>
                            <li>I'll order MVRs for all drivers once we receive the above documents</li>
                            <li>Within 24-48 hours of receiving all documents, I'll present you with competitive quotes from multiple carriers</li>
                        </ol>
                        
                        <div style="background: #e9ecef; padding: 15px; border-radius: 8px; margin: 20px 0;">
                            <p style="margin: 0; font-size: 14px;"><strong>Questions?</strong> Don't hesitate to call me directly at (509) 215-3433. I'm here to make this process as smooth as possible and ensure you get the best coverage at competitive rates.</p>
                        </div>
                        
                        <p>Thank you for choosing Network TruckInsurance Services. I look forward to working with you!</p>
                        
                        <p>Best regards,<br>
                        <strong>Ed Zahnle</strong><br>
                        Licensed Insurance Agent/Broker<br>
                        Network TruckInsurance Services, Inc.<br>
                        Direct: (509) 215-3433<br>
                        Email: ed.zahnle@truckerinsurance.com</p>
                    </div>
                    
                    <div style="background: #2c3e50; color: white; padding: 15px; text-align: center; font-size: 12px;">
                        <p style="margin: 0;">This email was sent regarding your commercial trucking insurance quote request ${formData.quoteId}.<br>
                        Network TruckInsurance Services, Inc. | Licensed Agent Ed Zahnle</p>
                    </div>
                </div>
            `;
        }
        
        function generateSimplePDF(formData) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let yPosition = 15;
                
                // Header with border boxes
                doc.setLineWidth(0.5);
                
                // Main title box (left side)
                doc.rect(15, 10, 120, 25);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('TRUCKERS QUOTE SHEET', 75, yPosition + 10, { align: 'center' });
                
                // Company info box (right side)
                doc.rect(135, 10, 60, 25);
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('Network Truck', 137, yPosition + 5);
                doc.text('Insurance Services, Inc.', 137, yPosition + 9);
                doc.setFont(undefined, 'normal');
                doc.text('PH (509) 215-3433', 137, yPosition + 13);
                doc.text('FAX Available upon request', 137, yPosition + 17);
                
                // Agent info section (left side of header box)
                doc.setFontSize(9);
                doc.setFont(undefined, 'normal');
                doc.text(`AGENT: Ed Zahnle`, 17, yPosition + 5);
                doc.text(`CLIENT# ${formData.usdotNumber || formData.agencyNumber || ''}`, 17, yPosition + 9);
                doc.text(`Lic# OD48006`, 17, yPosition + 17);
                
                yPosition = 40;
                
                // Date and target price section
                doc.setFontSize(9);
                const today = new Date().toLocaleDateString('en-US');
                doc.text(`Todays Date`, 15, yPosition);
                doc.rect(45, yPosition - 4, 35, 8);
                doc.text(today, 47, yPosition);
                
                doc.text(`Effective Date`, 85, yPosition);
                doc.rect(115, yPosition - 4, 35, 8);
                doc.text('TBD', 117, yPosition);
                
                doc.text(`TARGET PRICE         .btn-debug {
            background: #f39c12;
            color: white;
            margin-left: 10px;
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trucking Insurance Quote Form - Internal Use</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header .contact-info {
            font-size: 16px;
            opacity: 0.95;
            margin: 15px 0;
        }
        
        .header .subtitle {
            border-top: 2px solid rgba(255,255,255,0.3);
            padding-top: 20px;
            margin-top: 20px;
        }
        

        
        .progress-bar {
            background: #e9ecef;
            height: 6px;
            position: relative;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .section {
            border-bottom: 1px solid #e9ecef;
        }
        
        .section:last-of-type {
            border-bottom: none;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-left: 5px solid #3498db;
            font-weight: 600;
            color: #2c3e50;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-status {
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 20px;
            background: #e9ecef;
            color: #6c757d;
        }
        
        .section-status.complete {
            background: #d4edda;
            color: #155724;
        }
        
        .section-status.partial {
            background: #fff3cd;
            color: #856404;
        }
        
        .section-content {
            padding: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        input.error, select.error, textarea.error {
            border-color: #e74c3c;
            background-color: #fdf2f2;
        }
        
        input.valid, select.valid, textarea.valid {
            border-color: #27ae60;
            background-color: #f8fff9;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        
        .notes {
            font-size: 12px;
            color: #6c757d;
            font-style: italic;
            margin-top: 4px;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .btn-save {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 30px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        
        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        .btn-save:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading-spinner {
            display: none;
            margin-left: 10px;
        }
        
        .validation-summary {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }
        
        .validation-summary h4 {
            color: #721c24;
            margin-bottom: 10px;
        }
        
        .validation-summary ul {
            margin-left: 20px;
            color: #721c24;
        }
        
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        .success-message h3 {
            color: #155724;
            margin-bottom: 10px;
        }
        
        .success-message p {
            color: #155724;
            margin: 10px 0;
        }
        
        .quote-summary {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .summary-header {
            color: #2c3e50;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .summary-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .summary-label {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .summary-value {
            font-size: 16px;
            color: #2c3e50;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 0;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .section-content {
                padding: 20px;
            }
        }
        
        @media print {
            .btn, button {
                display: none;
            }
            
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Network TruckInsurance Services, Inc.</h1>
            <div class="contact-info">
                <strong>Ed Zahnle - Licensed Agent/Broker</strong><br>
                Phone: (509) 215-3433 | Email: ed.zahnle@truckerinsurance.com
            </div>
            <div class="subtitle">
                <h2>Professional Insurance Quote Application</h2>
                <p>Complete Commercial Trucking Insurance Solutions</p>
            </div>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <!-- Validation Summary -->
        <div class="validation-summary" id="validationSummary">
            <h4>Please Complete Required Fields:</h4>
            <ul id="validationList"></ul>
        </div>
        
        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <h3>Quote Successfully Submitted!</h3>
            <p>Your quote has been submitted and saved to our system.</p>
            <p>A document request email has been sent to your provided email address.</p>
            <p>Ed Zahnle will contact you within 24 hours to discuss your quote.</p>
        </div>
        
        <form id="quoteForm" onsubmit="return false;" novalidate>
            <!-- Section 1: Business Information -->
            <div class="section">
                <div class="section-header">
                    <span>1. Business Information</span>
                    <span class="section-status" id="section1Status">Incomplete</span>
                </div>
                <div class="section-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="businessName">Business Name <span class="required">*</span></label>
                            <input type="text" id="businessName" name="businessName" required 
                                   placeholder="Legal name of insured">
                            <div class="error-message">Business name is required</div>
                            <div class="notes">Legal business name as registered</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dba">DBA (if different)</label>
                            <input type="text" id="dba" name="dba" 
                                   placeholder="Doing Business As name">
                            <div class="notes">Operating name if different from legal name</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="contactName">Contact Name <span class="required">*</span></label>
                            <input type="text" id="contactName" name="contactName" required 
                                   placeholder="Primary contact person">
                            <div class="error-message">Contact name is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phoneNumber">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="phoneNumber" name="phoneNumber" required 
                                   placeholder="(555) 123-4567">
                            <div class="error-message">Valid phone number is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="faxNumber">Fax Number</label>
                            <input type="tel" id="faxNumber" name="faxNumber" 
                                   placeholder="(555) 123-4567">
                        </div>
                        
                        <div class="form-group">
                            <label for="emailAddress">Email Address <span class="required">*</span></label>
                            <input type="email" id="emailAddress" name="emailAddress" required 
                                   placeholder="contact@company.com">
                            <div class="error-message">Valid email address is required</div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="businessAddress">Mailing Address <span class="required">*</span></label>
                            <input type="text" id="businessAddress" name="businessAddress" required 
                                   placeholder="Street Address" style="margin-bottom: 10px;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px;">
                                <input type="text" id="businessCity" name="businessCity" required placeholder="City">
                                <input type="text" id="businessState" name="businessState" required placeholder="State">
                                <input type="text" id="businessZip" name="businessZip" required placeholder="ZIP Code">
                            </div>
                            <div class="error-message">Complete mailing address is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="businessType">Business Type <span class="required">*</span></label>
                            <select id="businessType" name="businessType" required>
                                <option value="">Select business type...</option>
                                <option value="Individual">Individual</option>
                                <option value="Partnership">Partnership</option>
                                <option value="Corporation">Corporation</option>
                                <option value="LLC">LLC</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="error-message">Business type is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="usdotNumber">USDOT Number <span class="required">*</span></label>
                            <input type="text" id="usdotNumber" name="usdotNumber" required 
                                   placeholder="1234567">
                            <div class="error-message">USDOT number is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="mcNumber">MC Number <span class="required">*</span></label>
                            <input type="text" id="mcNumber" name="mcNumber" required 
                                   placeholder="MC-123456">
                            <div class="error-message">MC number is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="stateNumber">State Number</label>
                            <input type="text" id="stateNumber" name="stateNumber" 
                                   placeholder="CA-123456, TX-12345, etc.">
                            <div class="notes">State intrastate authority numbers</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="feinNumber">Federal EIN</label>
                            <input type="text" id="feinNumber" name="feinNumber" 
                                   placeholder="12-3456789">
                            <div class="notes">Federal Employer Identification Number</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="agencyNumber">Agency Number <span class="required">*</span></label>
                            <input type="text" id="agencyNumber" name="agencyNumber" required 
                                   placeholder="NTI-2024-001">
                            <div class="error-message">Agency number is required</div>
                            <div class="notes">Internal agency tracking identifier</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="yearsInBusiness">Years in Business <span class="required">*</span></label>
                            <select id="yearsInBusiness" name="yearsInBusiness" required>
                                <option value="">Select years in business...</option>
                                <option value="New Venture">New Venture</option>
                                <option value="<1">Less than 1 year</option>
                                <option value="1-3">1-3 years</option>
                                <option value="4-7">4-7 years</option>
                                <option value="8+">8+ years</option>
                            </select>
                            <div class="error-message">Years in business is required</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="grossReceipts">Annual Gross Receipts <span class="required">*</span></label>
                            <input type="text" id="grossReceipts" name="grossReceipts" required 
                                   placeholder="$500,000">
                            <div class="error-message">Annual gross receipts required</div>
                            <div class="notes">Current year estimated</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="priorYearReceipts">Prior Year Gross Receipts</label>
                            <input type="text" id="priorYearReceipts" name="priorYearReceipts" 
                                   placeholder="$450,000">
                            <div class="notes">Previous year actual</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quote Summary Section -->
            <div class="quote-summary">
                <div class="summary-header">Quote Summary</div>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Quote ID (USDOT)</div>
                        <div class="summary-value" id="quoteId">Enter USDOT number</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Date Created</div>
                        <div class="summary-value" id="quoteDate">Loading...</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Business Name</div>
                        <div class="summary-value" id="summaryBusinessName">Not entered</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Contact</div>
                        <div class="summary-value" id="summaryContactName">Not entered</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Submission Status</div>
                        <div class="summary-value" id="submissionStatus">Ready to Test</div>
                    </div>
                </div>
            </div>
        </form>
        
        <!-- Submit Button -->
        <div style="text-align: center; padding: 30px;">
            <button type="button" class="btn-save" id="submitBtn" onclick="submitQuote()">
                Generate Professional Quote PDF
                <span class="loading-spinner" id="loadingSpinner">âŸ³</span>
            </button>
        </div>
    </div>
    
    <!-- Load jsPDF from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
    
    <script>
        // Your deployed Google Apps Script URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxrcWAKtm8dDicdDNRToxyaR1YKzFHHBan-tJww4fNT9ZkDfHBZEXHdC14CChFMGexY/exec';
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeQuote();
            setupEventListeners();
        });
        
        function initializeQuote() {
            const today = new Date();
            const dateString = today.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('quoteId').textContent = 'Enter USDOT number';
            document.getElementById('quoteDate').textContent = dateString;
        }
        
        function setupEventListeners() {
            // Update summary on changes
            document.getElementById('businessName').addEventListener('input', function() {
                document.getElementById('summaryBusinessName').textContent = this.value || 'Not entered';
            });
            
            document.getElementById('contactName').addEventListener('input', function() {
                document.getElementById('summaryContactName').textContent = this.value || 'Not entered';
            });
            
            document.getElementById('usdotNumber').addEventListener('input', function() {
                updateQuoteId();
            });
        }
        
        function updateQuoteId() {
            const usdotNumber = document.getElementById('usdotNumber').value;
            const quoteId = usdotNumber ? `DOT-${usdotNumber}` : 'Enter USDOT number';
            document.getElementById('quoteId').textContent = quoteId;
            return quoteId;
        }
        
        function collectFormData() {
            const formData = {
                // Basic business info
                businessName: document.getElementById('businessName').value,
                contactName: document.getElementById('contactName').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                emailAddress: document.getElementById('emailAddress').value,
                businessAddress: document.getElementById('businessAddress').value,
                businessCity: document.getElementById('businessCity').value,
                businessState: document.getElementById('businessState').value,
                businessZip: document.getElementById('businessZip').value,
                businessType: document.getElementById('businessType').value,
                usdotNumber: document.getElementById('usdotNumber').value,
                mcNumber: document.getElementById('mcNumber').value,
                agencyNumber: document.getElementById('agencyNumber').value,
                yearsInBusiness: document.getElementById('yearsInBusiness').value,
                grossReceipts: document.getElementById('grossReceipts').value,
                priorYearReceipts: document.getElementById('priorYearReceipts').value,
                
                // Meta data
                quoteId: updateQuoteId(),
                submissionDate: new Date().toISOString(),
                timestamp: Date.now(),
                vehicleCount: 1, // Default for basic form
                selectedCoverages: ['Auto Liability'], // Default
                routesOfTravel: 'Western United States' // Default
            };
            
            return formData;
        }
        
        function validateBasicForm() {
            const requiredFields = [
                'businessName', 'contactName', 'phoneNumber', 'emailAddress',
                'businessAddress', 'businessCity', 'businessState', 'businessZip',
                'businessType', 'usdotNumber', 'mcNumber', 'agencyNumber', 'yearsInBusiness', 'grossReceipts'
            ];
            
            const errors = [];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    errors.push(fieldId);
                }
            });
            
            if (errors.length > 0) {
                const validationSummary = document.getElementById('validationSummary');
                const validationList = document.getElementById('validationList');
                
                validationList.innerHTML = errors.map(error => `<li>${error.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</li>`).join('');
                validationSummary.style.display = 'block';
                validationSummary.scrollIntoView({ behavior: 'smooth', block: 'start' });
                return false;
            }
            
            document.getElementById('validationSummary').style.display = 'none';
            return true;
        }
        
        async function submitQuote() {
            // Basic validation
            if (!validateBasicForm()) {
                return;
            }
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const spinner = document.getElementById('loadingSpinner');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.disabled = true;
            spinner.style.display = 'inline';
            submitBtn.innerHTML = 'Processing Quote... <span class="loading-spinner">âŸ³</span>';
            
            try {
                // Collect form data
                const formData = collectFormData();
                
                // Submit to Google Sheets
                await submitToGoogleSheets(formData);
                
                // Send document request email
                await sendDocumentRequestEmail(formData);
                
                // Generate PDF
                const pdfFilename = generateSimplePDF(formData);
                
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Update submission status
                document.getElementById('submissionStatus').textContent = 'Successfully Submitted';
                
            } catch (error) {
                alert('There was an issue submitting your quote. Your data may have been saved to our system. Ed Zahnle will contact you at the provided phone number.');
                
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                spinner.style.display = 'none';
                submitBtn.innerHTML = originalText;
            }
        }
        
        async function submitToGoogleSheets(formData) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                    mode: 'no-cors'
                });
                
                return true; // Assume success since we can't read the response in no-cors mode
                
            } catch (error) {
                // Don't throw error - the data was likely sent successfully
                return true;
            }
        }
        
        async function sendDocumentRequestEmail(formData) {
            try {
                const emailData = {
                    action: 'sendDocumentRequest',
                    from: 'ed.zahnle@truckerinsurance.com',
                    to: formData.emailAddress,
                    cc: 'ed.zahnle@truckerinsurance.com',
                    subject: `Document Request - Commercial Trucking Insurance Quote ${formData.quoteId}`,
                    html: generateEmailHTML(formData)
                };
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailData),
                    mode: 'no-cors'
                });
                
                return true; // Assume success
                
            } catch (error) {
                // Don't throw error - email may have been sent
                return true;
            }
        }
        
        function generateEmailHTML(formData) {
            return `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <div style="background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 20px; text-align: center;">
                        <h2>Network TruckInsurance Services, Inc.</h2>
                        <p>Ed Zahnle - Licensed Agent/Broker<br>
                        Phone: (509) 215-3433 | Email: ed.zahnle@truckerinsurance.com</p>
                    </div>
                    
                    <div style="padding: 30px; background: white;">
                        <p>Dear ${formData.contactName},</p>
                        
                        <p>Thank you for submitting your commercial trucking insurance quote request. I have received your application and am excited to help you secure competitive coverage for <strong>${formData.businessName}</strong>.</p>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-left: 4px solid #3498db; margin: 20px 0;">
                            <h3 style="color: #2c3e50; margin-top: 0;">Quote Summary:</h3>
                            <ul style="margin: 10px 0;">
                                <li><strong>Quote ID:</strong> ${formData.quoteId}</li>
                                <li><strong>Agency Number:</strong> ${formData.agencyNumber}</li>
                                <li><strong>Business:</strong> ${formData.businessName}</li>
                                <li><strong>USDOT:</strong> ${formData.usdotNumber}</li>
                                <li><strong>MC Number:</strong> ${formData.mcNumber}</li>
                                <li><strong>Contact:</strong> ${formData.contactName}</li>
                                <li><strong>Phone:</strong> ${formData.phoneNumber}</li>
                            </ul>
                        </div>
                        
                        <p>To complete your quote package and provide you with accurate pricing from our top-rated carriers (Progressive, Sentry, BHHC), I will need the following documents:</p>
                        
                        <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3 style="color: #856404; margin-top: 0;">ðŸ“‹ Required Documents:</h3>
                            <ol style="color: #856404;">
                                <li><strong>Loss Runs from your current/prior insurance carrier</strong> (last 5 years)
                                    <br><small>â€¢ This shows your claims history and is required by all underwriters</small>
                                </li>
                                <li><strong>IFTA Reports</strong> (last 4 quarters)
                                    <br><small>â€¢ Interstate Fuel Tax Agreement reports showing mileage by state</small>
                                </li>
                                <li><strong>Motor Vehicle Records (MVRs)</strong> - <em>We will handle ordering these directly</em>
                                    <br><small>â€¢ No action needed from you on MVRs</small>
                                </li>
                            </ol>
                        </div>
                        
                        <div style="background: #d4edda; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3 style="color: #155724; margin-top: 0;">ðŸš€ Need Help Getting Loss Runs?</h3>
                            <p style="color: #155724; margin-bottom: 0;">Many carriers require written authorization to release loss runs to agents. <strong>I can create the official request documents for you and send them via Adobe Sign for electronic signature.</strong> This makes the process quick and ensures your current carrier has everything they need to release your loss run history.</p>
                            
                            <p style="color: #155724; margin-bottom: 0;"><strong>Just reply to this email and let me know if you'd like me to prepare the loss run request documents for Adobe Sign!</strong></p>
                        </div>
                        
                        <h3 style="color: #2c3e50;">Next Steps:</h3>
                        <ol>
                            <li>Reply to this email with your IFTA reports (PDF format preferred)</li>
                            <li>Contact your current insurance carrier to request loss runs, or let me help with Adobe Sign requests</li>
                            <li>I'll order MVRs for all drivers once we receive the above documents</li>
                            <li>Within 24-48 hours of receiving all documents, I'll present you with competitive quotes from multiple carriers</li>
                        </ol>
                        
                        <div style="background: #e9ecef; padding: 15px; border-radius: 8px; margin: 20px 0;">
                            <p style="margin: 0; font-size: 14px;"><strong>Questions?</strong> Don't hesitate to call me directly at (509) 215-3433. I'm here to make this process as smooth as possible and ensure you get the best coverage at competitive rates.</p>
                        </div>
                        
                        <p>Thank you for choosing Network TruckInsurance Services. I look forward to working with you!</p>
                        
                        <p>Best regards,<br>
                        <strong>Ed Zahnle</strong><br>
                        Licensed Insurance Agent/Broker<br>
                        Network TruckInsurance Services, Inc.<br>
                        Direct: (509) 215-3433<br>
                        Email: ed.zahnle@truckerinsurance.com</p>
                    </div>
                    
                    <div style="background: #2c3e50; color: white; padding: 15px; text-align: center; font-size: 12px;">
                        <p style="margin: 0;">This email was sent regarding your commercial trucking insurance quote request ${formData.quoteId}.<br>
                        Network TruckInsurance Services, Inc. | Licensed Agent Ed Zahnle</p>
                    </div>
                </div>
            `;
        }
        
, 155, yPosition);
                doc.rect(180, yPosition - 4, 15, 8);
                
                yPosition += 12;
                
                // Business information section
                doc.text(`Legal Name`, 15, yPosition);
                doc.text(`${formData.businessName || ''}`, 55, yPosition);
                doc.text(`Telephone#`, 120, yPosition);
                doc.text(`${formData.phoneNumber || ''}`, 145, yPosition);
                
                yPosition += 6;
                doc.text(`DBA:`, 15, yPosition);
                doc.text(`${formData.dba || ''}`, 55, yPosition);
                doc.text(`Fax#`, 120, yPosition);
                doc.text(``, 145, yPosition);
                
                yPosition += 6;
                doc.text(`Mailing Address`, 15, yPosition);
                doc.text(`${formData.businessAddress || ''}`, 55, yPosition);
                doc.text(`Pgr/Mob#`, 120, yPosition);
                
                yPosition += 6;
                doc.text(`${formData.businessCity || ''} ${formData.businessState || ''} ${formData.businessZip || ''}`, 55, yPosition);
                
                // Business type checkboxes
                const businessType = formData.businessType || '';
                doc.text(`${businessType === 'Individual' ? 'â˜‘' : 'â˜'} Individual`, 120, yPosition);
                doc.text(`${businessType === 'Partnership' ? 'â˜‘' : 'â˜'} Partner`, 150, yPosition);
                doc.text(`${businessType === 'Corporation' || businessType === 'LLC' ? 'â˜‘' : 'â˜'} Corp`, 175, yPosition);
                
                yPosition += 8;
                
                // Garaging address
                doc.text(`Garaging Address`, 15, yPosition);
                doc.text(`Same as above`, 55, yPosition);
                doc.text(`CA#`, 120, yPosition);
                doc.text(`MC#`, 150, yPosition);
                doc.text(`${formData.mcNumber || ''}`, 160, yPosition);
                
                yPosition += 6;
                doc.text(`Other filings?`, 120, yPosition);
                doc.text(`USDOT: ${formData.usdotNumber || ''}`, 150, yPosition);
                
                yPosition += 8;
                
                // Years in business and venture info
                doc.text(`Years in Business`, 15, yPosition);
                doc.text(`${formData.yearsInBusiness || ''}`, 55, yPosition);
                doc.text(`New Venture?`, 90, yPosition);
                const isNewVenture = formData.yearsInBusiness === 'New Venture' || formData.yearsInBusiness === '<1';
                doc.text(`${isNewVenture ? 'â˜‘' : 'â˜'} Yes ${isNewVenture ? 'â˜' : 'â˜‘'} No`, 115, yPosition);
                doc.text(`If yes, previous employer`, 145, yPosition);
                
                yPosition += 6;
                doc.text(`Exclusive haul?`, 15, yPosition);
                doc.text(`â˜ Yes â˜‘ No`, 55, yPosition);
                doc.text(`If yes, how many years & for whom?`, 85, yPosition);
                
                yPosition += 6;
                doc.text(`Commodity Hauled (percentage)`, 15, yPosition);
                doc.text(`Dry Freight 100%, %, %`, 75, yPosition);
                
                yPosition += 6;
                doc.text(`Hauling hazardous materials or placarded loads?`, 15, yPosition);
                doc.text(`â˜ Yes â˜‘ No`, 95, yPosition);
                doc.text(`If yes, please list`, 125, yPosition);
                
                yPosition += 6;
                doc.text(`Routes of Travel (major cities)`, 15, yPosition);
                doc.text(`${formData.routesOfTravel || 'Western United States'}`, 75, yPosition);
                
                yPosition += 8;
                
                // Financial information
                doc.text(`Gross Receipts: Current Year Est.`, 15, yPosition);
                doc.text(`${formData.grossReceipts || ''}`, 75, yPosition);
                doc.text(`Prior Year`, 120, yPosition);
                doc.text(`${formData.priorYearReceipts || ''}`, 140, yPosition);
                
                yPosition += 6;
                doc.text(`Subhaul Exposure?`, 15, yPosition);
                doc.text(`â˜ Yes â˜‘ No`, 55, yPosition);
                doc.text(`If yes, what is cost of hire`, 85, yPosition);
                
                yPosition += 10;
                
                // Coverages section with border
                doc.setFont(undefined, 'bold');
                doc.text('Coverages:', 15, yPosition);
                doc.setFont(undefined, 'normal');
                yPosition += 8;
                
                doc.rect(15, yPosition - 5, 180, 35);
                
                // Coverage details in table format
                doc.text(`Liability Limit`, 17, yPosition);
                doc.text(`$1,000,000`, 50, yPosition);
                doc.text(`Liability Ded.`, 85, yPosition);
                doc.text(`Hired/NOA?`, 120, yPosition);
                doc.text(`â˜ Yes â˜‘ No`, 145, yPosition);
                
                yPosition += 6;
                doc.text(`UM`, 17, yPosition);
                doc.text(`$100,000`, 50, yPosition);
                doc.text(`Physical Damage Ded.`, 85, yPosition);
                doc.text(`$1,000`, 120, yPosition);
                doc.text(`(if any basis)`, 145, yPosition);
                
                yPosition += 6;
                doc.text(`Cargo Limit`, 17, yPosition);
                doc.text(`$100,000`, 50, yPosition);
                doc.text(`Cargo Ded.`, 85, yPosition);
                doc.text(`$1,000`, 120, yPosition);
                doc.text(`Reefer Breakdown?`, 145, yPosition);
                doc.text(`â˜ Yes â˜‘ No`, 175, yPosition);
                
                yPosition += 6;
                doc.text(`Average Cargo Limit`, 17, yPosition);
                doc.text(`$100,000`, 50, yPosition);
                doc.text(`Loading/Unloading?`, 145, yPosition);
                doc.text(`â˜ Yes â˜‘ No`, 175, yPosition);
                
                yPosition += 6;
                doc.text(`General Liability`, 17, yPosition);
                doc.text(`1M/2M`, 50, yPosition);
                doc.text(`G.L. Ded.`, 85, yPosition);
                
                yPosition += 6;
                doc.text(`Other Coverages?`, 17, yPosition);
                doc.text(`Trailer Interchange $35,000`, 50, yPosition);
                
                yPosition += 10;
                
                // Previous Carriers & Loss History section
                doc.setFont(undefined, 'bold');
                doc.text('Previous Carriers & Loss History:', 15, yPosition);
                doc.setFont(undefined, 'normal');
                yPosition += 8;
                
                // Table headers
                doc.rect(15, yPosition - 3, 180, 8);
                doc.setFontSize(8);
                doc.text('Year', 17, yPosition);
                doc.text('Company', 35, yPosition);
                doc.text('Policy #', 75, yPosition);
                doc.text('# of claims', 105, yPosition);
                doc.text('Type', 135, yPosition);
                doc.text('$ Paid Out', 165, yPosition);
                
                yPosition += 8;
                
                // Sample data rows
                doc.rect(15, yPosition - 3, 180, 6);
                doc.text('24-25', 17, yPosition);
                doc.text('Current Carrier TBD', 35, yPosition);
                doc.text('TBD', 75, yPosition);
                doc.text('0', 105, yPosition);
                doc.text('Auto Lib', 135, yPosition);
                doc.text('$0', 165, yPosition);
                
                yPosition += 6;
                doc.rect(15, yPosition - 3, 180, 6);
                doc.text('23-24', 17, yPosition);
                
                yPosition += 12;
                
                // Vehicles section
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text('Vehicles:', 15, yPosition);
                doc.setFont(undefined, 'normal');
                yPosition += 8;
                
                // Vehicle table headers
                doc.rect(15, yPosition - 3, 180, 8);
                doc.setFontSize(7);
                doc.text('#', 17, yPosition);
                doc.text('Year', 25, yPosition);
                doc.text('Make', 40, yPosition);
                doc.text('Body Type', 60, yPosition);
                doc.text('GVW', 80, yPosition);
                doc.text('Serial #', 100, yPosition);
                doc.text('Ann. Miles', 140, yPosition);
                doc.text('Radius', 160, yPosition);
                doc.text('Value', 180, yPosition);
                
                yPosition += 8;
                
                // Sample vehicle row
                doc.rect(15, yPosition - 3, 180, 6);
                doc.text('1', 17, yPosition);
                doc.text('TBD', 25, yPosition);
                doc.text('TBD', 40, yPosition);
                doc.text('TT', 60, yPosition);
                doc.text('80,000', 80, yPosition);
                doc.text('TBD', 100, yPosition);
                doc.text('100,000', 140, yPosition);
                doc.text('500+', 160, yPosition);
                doc.text('TBD', 180, yPosition);
                
                yPosition += 12;
                
                // Drivers section
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text('Drivers:', 15, yPosition);
                doc.setFont(undefined, 'normal');
                yPosition += 8;
                
                // Driver table headers
                doc.rect(15, yPosition - 3, 180, 8);
                doc.setFontSize(7);
                doc.text('Name', 17, yPosition);
                doc.text('DL#', 60, yPosition);
                doc.text('DOB', 90, yPosition);
                doc.text('Yrs Exp', 110, yPosition);
                doc.text('DOH', 130, yPosition);
                doc.text('SS#', 150, yPosition);
                doc.text('Tick/Acc', 170, yPosition);
                
                yPosition += 8;
                
                // Sample driver row
                doc.rect(15, yPosition - 3, 180, 6);
                doc.text(`${formData.contactName || 'TBD'}`, 17, yPosition);
                doc.text('TBD', 60, yPosition);
                doc.text('TBD', 90, yPosition);
                doc.text('TBD', 110, yPosition);
                doc.text('TBD', 130, yPosition);
                doc.text('TBD', 150, yPosition);
                doc.text('0/0', 170, yPosition);
                
                yPosition += 12;
                
                // Claims description
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text('Describe any accidents/claims in the last 3 years', 15, yPosition);
                doc.setFont(undefined, 'normal');
                yPosition += 6;
                doc.line(15, yPosition, 195, yPosition);
                
                // Save with professional filename
                const filename = `QUOTE_${formData.usdotNumber || 'NEW'}_${today.replace(/\//g, '-')}.pdf`;
                doc.save(filename);
                
                return filename;
                
            } catch (error) {
                throw new Error('PDF generation failed: ' + error.message);
            }
        }
    </script>
</body>
</html>
